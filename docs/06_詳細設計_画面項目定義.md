# 資産管理システム 詳細設計書（画面項目定義）

## 0. 文書情報
- 文書名: 資産管理システム 詳細設計書（画面項目定義）
- 版数: v0.3（ドラフト）
- 作成日: 2026-02-17
- 参照: `docs/02_要件定義書.md`, `docs/03_基本設計書.md`

## 1. 方針
- 画面項目は `属性コード` 基準で管理する
- 必須/任意は要件定義のルールに従う
- 一覧系は検索条件を保持したままCSV出力可能とする
- 業務画面はログイン済セッションを前提とする
- ユーザ登録機能は業務画面に設けない（Django管理画面で実施）

## 1.1 ログイン（SCR-000）
### 1.1.1 入力項目
| 項目ID | 項目名 | 型 | 必須 | 入力規則 |
|---|---|---|---|---|
| LG-001 | ユーザID | varchar(150) | 必須 | Djangoユーザ名 |
| LG-002 | パスワード | password | 必須 | マスク表示 |

### 1.1.2 動作
- 認証成功時: ダッシュボード（SCR-001）へ遷移
- 認証失敗時: エラーメッセージ表示、再入力
- 備考: ユーザ新規登録導線は表示しない

## 2. ダッシュボード（SCR-001）
### 2.1 表示項目
| 項目ID | 項目名 | 型 | 表示/入力 | 備考 |
|---|---|---|---|---|
| DS-001 | 予算消化率 | 数値（%） | 表示 | 当年度合計 |
| DS-002 | 未紐付け資産件数 | 数値 | 表示 | budget_link_status=未設定 |
| DS-003 | 保守期限30日以内件数 | 数値 | 表示 | 日次集計 |
| DS-004 | 棚卸差異件数 | 数値 | 表示 | 最新棚卸基準 |

## 3. 資産一覧（SCR-010）
### 3.1 検索条件
| 項目ID | 項目名 | 型 | 必須 | 入力規則 |
|---|---|---|---|---|
| AS-S-001 | 資産コード | 文字列 | 任意 | 前方一致 |
| AS-S-002 | 資産名 | 文字列 | 任意 | 部分一致 |
| AS-S-003 | 小分類 | 選択 | 任意 | `category_s_id` |
| AS-S-004 | ステータス | 選択 | 任意 | 複数選択可 |
| AS-S-005 | 予算紐付け状態 | 選択 | 任意 | 未設定/設定済 |
| AS-S-006 | 利用者 | 選択 | 任意 | person_attr_01 |

### 3.2 一覧表示列
| 項目ID | 項目名 | ソース |
|---|---|---|
| AS-L-001 | 資産コード | `asset.asset_code` |
| AS-L-002 | 資産名 | `asset.asset_name` |
| AS-L-003 | 分類 | 大/中/小分類名 |
| AS-L-004 | ステータス | `asset.status` |
| AS-L-005 | 予算紐付け状態 | `asset.budget_link_status` |
| AS-L-006 | 利用者 | `person_attr_01` |
| AS-L-007 | 期限日 | `date_attr_03` |

### 3.3 状態遷移操作（追加）
| 項目ID | 項目名 | 型 | 必須 | 入力規則 |
|---|---|---|---|---|
| AS-T-001 | 遷移先状態 | 選択 | 条件付必須 | 大分類別遷移マスタに存在する遷移先のみ表示 |
| AS-T-002 | 状態遷移実行 | ボタン | 任意 | 押下時に `workflow_service` 経由で更新 |

動作:
- 一覧行ごとに、現在状態から遷移可能な状態のみをプルダウン表示する
- 遷移不可な状態指定時は更新せずエラー表示する
- 状態遷移の判定は `大分類 × 遷移元状態 × 遷移先状態` の遷移マスタで行う

## 4. 資産詳細/編集（SCR-011）
### 4.1 基本情報
| 項目ID | 属性コード | 項目名 | 型 | 必須 | 入力規則 |
|---|---|---|---|---|---|
| AS-D-001 | - | 資産コード | varchar(50) | 必須 | 一意 |
| AS-D-002 | - | 資産名 | varchar(200) | 必須 | 200文字以内 |
| AS-D-003 | - | 大分類 | 選択 | 必須 | 階層整合 |
| AS-D-004 | - | 中分類 | 選択 | 必須 | 階層整合 |
| AS-D-005 | - | 小分類 | 選択 | 必須 | 階層整合 |
| AS-D-006 | - | ステータス | 選択 | 必須 | workflow_service管理 |

### 4.2 属性20入力
| 項目ID | 属性コード | 項目名 | 型 | 必須 | 入力規則 |
|---|---|---|---|---|---|
| AS-A-001 | cls_attr_01 | 資産個別分類1 | varchar(50) | 任意 | 分類別選択肢 |
| AS-A-002 | cls_attr_02 | 資産個別分類2 | varchar(50) | 任意 | 分類別選択肢 |
| AS-A-003 | cls_attr_03 | 資産個別分類3 | varchar(50) | 任意 | 分類別選択肢 |
| AS-A-004 | cls_attr_04 | 資産個別分類4 | varchar(50) | 任意 | 分類別選択肢 |
| AS-A-005 | cls_attr_05 | 資産個別分類5 | varchar(50) | 任意 | 分類別選択肢 |
| AS-A-006 | person_attr_01 | 利用者 | FK | 条件付必須 | PC種別時必須 |
| AS-A-007 | person_attr_02 | 管理責任者 | FK | 必須 | 利用者マスタ参照 |
| AS-A-008 | person_attr_03 | 最終更新者 | FK | 必須 | 保存時自動設定 |
| AS-A-009 | location_attr_01 | 設置場所 | varchar(100) | 任意 | 場所マスタ参照 |
| AS-A-010 | location_attr_02 | 保管場所 | varchar(100) | 任意 | 場所マスタ参照 |
| AS-A-011 | date_attr_01 | 購入日 | date | 任意 | YYYY-MM-DD |
| AS-A-012 | date_attr_02 | 利用開始日 | date | 任意 | YYYY-MM-DD |
| AS-A-013 | date_attr_03 | 期限日 | date | 任意 | 購入日以降 |
| AS-A-014 | free_text_attr_01 | 製品型番 | varchar(200) | 任意 | 200文字以内 |
| AS-A-015 | free_text_attr_02 | 識別ラベル | varchar(200) | 任意 | 200文字以内 |
| AS-A-016 | free_text_attr_03 | 補足説明 | varchar(500) | 任意 | 500文字以内 |
| AS-A-017 | multi_attr_01 | 付帯情報 | 複数行 | 任意 | 追加/削除可 |
| AS-A-018 | multi_attr_02 | 関連識別子 | 複数行 | 任意 | 同一資産内重複不可 |
| AS-A-019 | memo_attr_01 | 運用メモ | text | 任意 | 2000文字以内 |
| AS-A-020 | memo_attr_02 | 監査メモ | text | 任意 | 2000文字以内 |

### 4.3 予算紐付け
| 項目ID | 項目名 | 型 | 必須 | 備考 |
|---|---|---|---|---|
| AS-B-001 | 予算ID | FK | 任意 | 後付け可 |
| AS-B-002 | 予算紐付け状態 | enum | 必須 | 未設定/設定済 |

## 5. 構成ビュー（SCR-020）
| 項目ID | 項目名 | 型 | 必須 | 備考 |
|---|---|---|---|---|
| CF-001 | 構成コード | varchar(50) | 必須 | 一意 |
| CF-002 | 構成名 | varchar(200) | 必須 | - |
| CF-003 | 明細資産 | 複数行 | 必須 | 廃棄済追加不可 |
| CF-004 | ロール種別 | enum | 必須 | device/license/maintenance |
| CF-005 | 数量 | int | 必須 | 1以上 |

## 6. 予算/執行済予算（SCR-030）
| 項目ID | 項目名 | 型 | 必須 | 備考 |
|---|---|---|---|---|
| BG-001 | 年度 | int | 必須 | 4桁 |
| BG-002 | 予算科目 | varchar(100) | 必須 | - |
| BG-002A | 大分類 | 選択 | 必須 | 予算分類（3階層） |
| BG-002B | 中分類 | 選択 | 必須 | 予算分類（3階層） |
| BG-002C | 小分類 | 選択 | 必須 | 予算分類（3階層） |
| BG-003 | 予算額 | decimal | 必須 | 0以上 |
| BG-004 | 執行済日 | date | 任意 | YYYY-MM-DD |
| BG-005 | 執行済金額 | decimal | 任意 | 0以上 |
| BG-006 | 資産紐付け対象 | FK | 任意 | 後付け可 |

### 6.1 予算属性20（カテゴリ内訳）
| 項目ID | 属性カテゴリ | 項目数 | 入力ルール |
|---|---|---:|---|
| BG-A-01 | 個別分類 | 5 | 予算分類別選択肢 |
| BG-A-02 | 人 | 3 | 利用者マスタ参照 |
| BG-A-03 | 場所 | 2 | 場所マスタ参照 |
| BG-A-04 | 日付 | 3 | YYYY-MM-DD |
| BG-A-05 | 自由テキスト | 3 | 桁数上限あり |
| BG-A-06 | 1:n情報 | 2 | 別テーブル管理 |
| BG-A-07 | メモ | 2 | 2000文字以内 |

### 6.2 予算1:n情報（別テーブル）
| 項目ID | 項目名 | 型 | 必須 | 備考 |
|---|---|---|---|---|
| BG-M-001 | 属性種別 | enum | 必須 | MULTI_01/MULTI_02 |
| BG-M-002 | 値 | varchar(500) | 必須 | 複数行登録可 |
| BG-M-003 | 表示順 | int | 任意 | 既定1 |

## 7. ライセンスプール（SCR-040）
| 項目ID | 項目名 | 型 | 必須 | 備考 |
|---|---|---|---|---|
| LC-001 | ライセンス名 | varchar(200) | 必須 | - |
| LC-002 | 総数 | int | 必須 | 0以上 |
| LC-003 | 使用数 | int | 必須 | 総数以下 |
| LC-004 | 残数 | int | 表示 | 総数-使用数 |
| LC-005 | 契約期限 | date | 任意 | - |

## 8. PC管理（SCR-050）
| 項目ID | 項目名 | 型 | 必須 | 備考 |
|---|---|---|---|---|
| PC-001 | 資産コード | FK | 必須 | PC種別限定 |
| PC-002 | 利用者 | FK | 必須 | person_attr_01 |
| PC-003 | OS | varchar(100) | 必須 | - |
| PC-004 | スペック | varchar(500) | 任意 | - |
| PC-005 | 保証期限 | date | 任意 | - |

## 9. 棚卸（SCR-060）
| 項目ID | 項目名 | 型 | 必須 | 備考 |
|---|---|---|---|---|
| IV-001 | 棚卸回 | varchar(20) | 必須 | 年次識別 |
| IV-002 | 資産コード | FK | 必須 | - |
| IV-003 | 差異区分 | enum | 必須 | 不足/過剰/状態差異 |
| IV-004 | 是正ステータス | enum | 必須 | 未対応/対応中/完了 |
| IV-005 | 是正内容メモ | text | 任意 | 2000文字以内 |

## 10. 廃棄承認（SCR-070）
| 項目ID | 項目名 | 型 | 必須 | 備考 |
|---|---|---|---|---|
| DP-001 | 廃棄申請ID | bigint | 表示 | - |
| DP-002 | 資産コード | FK | 表示 | - |
| DP-003 | 申請者 | FK | 表示 | - |
| DP-004 | 証跡内容 | text | 条件付必須 | 承認時必須 |
| DP-005 | 承認可否 | boolean | 必須 | 承認/差戻し |
| DP-006 | 差戻し理由 | text | 条件付必須 | 差戻し時必須 |

## 11. 監査ログ閲覧（SCR-080）
| 項目ID | 項目名 | 型 | 必須 | 備考 |
|---|---|---|---|---|
| AL-001 | 対象テーブル | varchar(100) | 任意 | 絞り込み |
| AL-002 | 操作種別 | varchar(30) | 任意 | 絞り込み |
| AL-003 | 実行者 | FK | 任意 | 絞り込み |
| AL-004 | 実行日時From | datetime | 任意 | 絞り込み |
| AL-005 | 実行日時To | datetime | 任意 | 絞り込み |
| AL-006 | 変更要約 | text | 表示 | 詳細表示 |

## 12. 機能対応トレーサビリティ
| 機能ID | 機能 | 対応画面ID |
|---|---|---|
| F-00 | 認証/ユーザ管理 | SCR-000 |
| F-01 | ダッシュボード可視化 | SCR-001 |
| F-02 | 資産管理 | SCR-010, SCR-011 |
| F-03 | 構成管理 | SCR-020 |
| F-04 | 予算/執行済予算管理 | SCR-030 |
| F-05 | ライセンス管理 | SCR-040 |
| F-06 | PC管理 | SCR-050 |
| F-07 | 棚卸管理 | SCR-060 |
| F-08 | 廃棄承認 | SCR-070 |
| F-09 | 監査ログ閲覧 | SCR-080 |
