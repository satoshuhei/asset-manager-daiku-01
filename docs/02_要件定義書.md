# 資産管理システム 要件定義書

## 0. 文書情報
- 文書名: 資産管理システム 要件定義書
- 版数: v1.6（ドラフト）
- 作成日: 2026-02-17
- 対象: 部門内の有形/無形資産管理業務

## 1. 目的
部門内で分散・属人化している資産台帳、構成情報、ライセンス情報、予算情報を統合し、資産ライフサイクル（調達〜廃棄）を一元管理する。

## 2. 適用範囲
### 2.1 対象業務
- ログイン認証
- 資産登録（有形/無形）
- 構成管理（デバイス/ライセンス/保守の組み合わせ管理）
- 予算管理（予算/執行済予算）
- 利用管理（利用者割当、貸出）
- 保守管理（契約期限、更新判断）
- 棚卸管理（差異管理、是正）
- 廃棄管理（承認、証跡）

### 2.2 非対象
- 会計システムのリアルタイム連携実装
- 全社横断マスタ統合ポリシーの最終決定

## 3. 業務要件
### 3.1 管理対象
- 有形資産: PC、開発機器、計測機器、サーバ/ネットワーク機器、周辺機器
- 無形資産: ソフトウェアライセンス、フローティングライセンス、サブスクリプション、保守契約、クラウド利用契約
- 構成: 複数資産の論理的組み合わせ

### 3.2 業務ルール
- 全利用者はログイン後のみ業務画面へアクセス可能とする
- ユーザ登録/無効化はシステム管理者が Django 管理画面で実施する（業務画面での自己登録不可）
- 資産は予算未紐付けでも登録可能とする
- 予算/執行済予算は後付け・更新可能とする
- 予算情報は `大分類/中分類/小分類` の3階層分類を必須管理とする
- 予算情報は属性20（カテゴリ内訳付き）を保持し、入力定義を明示する
- 予算の1:n情報（2項目）は別テーブル管理とし、予算単位で複数行を許容する
- 未紐付け資産を継続的に可視化し、解消対象として管理する
- PC資産は利用者紐付けを必須とする
- 廃棄処理は承認必須とする
- 資産状態は大分類ごとに状態マスタで管理し、各大分類で約10状態を保持可能とする
- 資産状態の遷移可能性は大分類ごとの遷移マスタで管理する
- 資産状態の遷移操作は資産一覧画面で実施可能とする

### 3.3 ライフサイクル
1. 予算計画
2. 調達
3. 資産/構成登録
4. 利用管理
5. 保守管理
6. 更新/買い替え
7. 廃棄
8. 予算後追い紐付け

### 3.4 アクター定義
| アクターID | アクター名 | 主な責務 |
|---|---|---|
| ACT-01 | 資産管理担当（編集者） | 資産/構成/属性の登録・更新、棚卸差異の一次対応 |
| ACT-02 | 予算管理担当 | 予算・執行済予算の登録、資産への後付け紐付け |
| ACT-03 | 利用部門担当 | 利用申請、貸出返却、利用情報の更新依頼 |
| ACT-04 | 承認者 | 廃棄承認、更新判断承認、統制確認 |
| ACT-05 | システム管理者 | マスタ管理、権限管理、監査対応 |

### 3.5 ユースケース定義
| UC-ID | ユースケース名 | 主アクター | 事前条件 | 成功条件 |
|---|---|---|---|---|
| UC-00 | ログインする | ACT-01/ACT-02/ACT-03/ACT-04/ACT-05 | 有効なユーザが登録済 | セッションが確立される |
| UC-01 | 資産を登録する | ACT-01 | ログイン済、分類マスタ有効 | 資産と属性20が保存される |
| UC-02 | 資産情報を更新する | ACT-01 | 対象資産が存在 | 更新履歴と監査ログが残る |
| UC-03 | 構成を登録・更新する | ACT-01 | 対象資産が有効 | 構成明細が整合状態で保存される |
| UC-04 | 予算を登録する | ACT-02 | 対象年度/プロジェクト有効 | 予算が登録される |
| UC-05 | 執行済予算を登録する | ACT-02 | 予算が存在 | 執行済実績が履歴保存される |
| UC-06 | 資産へ予算を後付け紐付けする | ACT-02 | 資産/予算が存在 | 予算紐付け状態が更新される |
| UC-07 | ライセンスを割り当てる | ACT-01 | プール残数あり | 割当履歴が保存され残数更新 |
| UC-08 | PC利用者を割り当てる | ACT-01 | PC資産が存在 | 利用者紐付けが更新される |
| UC-09 | 棚卸差異を登録・是正する | ACT-01 | 棚卸回が開始済 | 差異と是正状態が更新される |
| UC-10 | 廃棄申請を承認する | ACT-04 | 廃棄申請が存在 | 承認結果と証跡が保存される |
| UC-11 | 監査ログを確認する | ACT-05 | 閲覧権限あり | 操作履歴を追跡できる |
| UC-12 | ユーザを登録/管理する | ACT-05 | Django管理画面へアクセス可能 | ユーザが有効化/無効化される |

### 3.6 ユースケースと機能要件の対応
| UC-ID | 対応機能要件 |
|---|---|
| UC-00, UC-12 | 4.0 認証/ユーザ管理 |
| UC-01, UC-02 | 4.1 資産管理 |
| UC-03 | 4.2 構成管理 |
| UC-04, UC-05, UC-06 | 4.3 予算/執行済予算管理 |
| UC-07 | 4.4 ライセンス管理 |
| UC-08 | 4.5 PC管理 |
| UC-09, UC-10 | 4.6 棚卸/廃棄管理 |
| UC-11 | 7. 非機能要件（監査ログ保持） |

### 3.7 ユースケース詳細フロー
#### UC-00 ログインする
- 基本フロー
	1. 利用者がログイン画面を開く
	2. ユーザIDとパスワードを入力する
	3. システムが認証を実行する
	4. システムがセッションを発行しダッシュボードへ遷移する
- 代替フロー
	- 2a. 既存セッションが有効な場合はログイン画面を省略して遷移する
- 例外フロー
	- E1. 認証失敗時はエラー表示し再入力を促す
	- E2. 無効ユーザの場合はログインを拒否する

#### UC-01 資産を登録する
- 基本フロー
	1. ACT-01 が資産登録画面を開く
	2. 基本情報（資産コード、分類、名称）を入力する
	3. 属性20を入力する
	4. システムが入力バリデーションを実施する
	5. システムが資産情報・属性情報を保存する
	6. システムが監査ログを記録し、完了を表示する
- 代替フロー
	- 3a. 予算情報が未確定の場合、予算未紐付けで登録する
- 例外フロー
	- E1. 資産コード重複時は保存せずエラー表示する
	- E2. PC種別で利用者未入力の場合は保存せずエラー表示する

#### UC-03 構成を登録・更新する
- 基本フロー
	1. ACT-01 が構成画面で構成ヘッダを登録/選択する
	2. 構成明細に資産を追加・更新する
	3. システムが明細整合性を検証する
	4. システムが構成と履歴を保存する
- 代替フロー
	- 2a. 既存テンプレートを選択して明細を自動展開する
- 例外フロー
	- E1. 廃棄済資産を追加しようとした場合は拒否する

#### UC-06 資産へ予算を後付け紐付けする
- 基本フロー
	1. ACT-02 が未紐付け資産一覧から対象資産を選択する
	2. 対象予算を選択し紐付けを実行する
	3. システムが参照整合性を検証する
	4. システムが `budget_id` と紐付け状態を更新する
	5. システムが変更履歴を記録する
- 代替フロー
	- 2a. 紐付け解除を選択した場合は `UNLINKED` に更新する
- 例外フロー
	- E1. 予算が無効/存在しない場合は更新を拒否する

#### UC-09 棚卸差異を登録・是正する
- 基本フロー
	1. ACT-01 が棚卸回を選択する
	2. 差異内容を登録する
	3. 是正ステータスを更新する
	4. システムが差異履歴を保存する
- 代替フロー
	- 3a. 是正困難な差異は承認者へエスカレーションする
- 例外フロー
	- E1. 棚卸回が未開始/終了済の場合は登録を拒否する

#### UC-10 廃棄申請を承認する
- 基本フロー
	1. ACT-04 が承認待ち廃棄申請を確認する
	2. 証跡内容を確認し承認する
	3. システムが申請状態を承認済へ更新する
	4. システムが対象資産のステータス遷移を実行する
	5. システムが監査ログを記録する
- 代替フロー
	- 2a. 差し戻し時は理由を記録して申請者へ返却する
- 例外フロー
	- E1. 必須証跡が不足する場合は承認を拒否する

#### UC-12 ユーザを登録/管理する
- 基本フロー
	1. ACT-05 が Django 管理画面へログインする
	2. ユーザ登録または既存ユーザ編集を実施する
	3. ロール/有効状態を設定する
	4. システムがユーザ情報を保存する
- 代替フロー
	- 2a. 一時停止対象ユーザは `is_active=false` として無効化する
- 例外フロー
	- E1. 既存ユーザ名重複時は登録を拒否する

## 4. 機能要件
### 4.0 認証/ユーザ管理
- ログイン機能を提供し、未認証アクセスを拒否する
- ユーザ登録/変更/無効化は Django 管理画面（管理者機能）のみで実施する
- 業務画面および業務APIでのユーザ自己登録機能は提供しない

### 4.1 資産管理
- 有形/無形資産の登録・更新・検索
- ステータス管理（大分類別状態マスタ準拠）
- ステータス遷移管理（大分類別遷移マスタ準拠）
- 資産一覧画面でのステータス遷移実行
- 予算紐付けステータス管理（未設定/設定済）

### 4.2 構成管理
- 構成（ヘッダ）と構成明細の管理
- 構成テンプレート運用
- 構成履歴の保持

### 4.3 予算/執行済予算管理
- 年度予算登録
- 執行済予算実績管理
- 資産への後付け紐付け
- 予算消化状況の可視化

### 4.4 ライセンス管理
- 固定ライセンス管理
- フローティングライセンスプール管理
- 使用数/残数可視化

### 4.5 PC管理
- 利用者紐付け
- OS/スペック管理
- 保証期限管理

### 4.6 棚卸/廃棄管理
- 棚卸対象管理
- 差異登録と是正ステータス管理
- 廃棄申請・承認・証跡保持

## 5. 画面要件
- ダッシュボード（予算状況、期限アラート、未紐付け資産件数）
- 資産一覧
- 資産詳細/編集
- 構成ビュー
- ライセンスプール画面
- 予算/執行済予算画面
- PC管理画面
- 棚卸画面

## 6. データ要件
### 6.1 分類体系
- 資産分類は `大分類/中分類/小分類` の3階層で管理する

### 6.1.1 状態/遷移マスタ（追加要件）
- 資産状態マスタは `大分類 × 状態コード` を一意に管理する
- 資産状態遷移マスタは `大分類 × 遷移元状態 × 遷移先状態` を一意に管理する
- 同一状態名でも大分類が異なる場合は別状態として管理可能とする

### 6.2 属性情報（20項目）
- 個別分類: 5
- 人: 3
- 場所: 2
- 日付: 3
- 自由テキスト: 3
- 1:n情報: 2
- メモ: 2

### 6.3 属性20 項目定義
| No | 属性コード | カテゴリ | 項目名 | データ型 | 必須 | 入力規則 |
|---:|---|---|---|---|---|---|
| 1 | cls_attr_01 | 個別分類 | 資産個別分類1 | varchar(50) | 任意 | 資産分類別の選択肢 |
| 2 | cls_attr_02 | 個別分類 | 資産個別分類2 | varchar(50) | 任意 | 資産分類別の選択肢 |
| 3 | cls_attr_03 | 個別分類 | 資産個別分類3 | varchar(50) | 任意 | 資産分類別の選択肢 |
| 4 | cls_attr_04 | 個別分類 | 資産個別分類4 | varchar(50) | 任意 | 資産分類別の選択肢 |
| 5 | cls_attr_05 | 個別分類 | 資産個別分類5 | varchar(50) | 任意 | 資産分類別の選択肢 |
| 6 | person_attr_01 | 人 | 利用者 | bigint(FK) | 条件付必須 | PC種別時必須 |
| 7 | person_attr_02 | 人 | 管理責任者 | bigint(FK) | 必須 | 利用者マスタ参照 |
| 8 | person_attr_03 | 人 | 最終更新者 | bigint(FK) | 必須 | 自動設定 |
| 9 | location_attr_01 | 場所 | 設置場所 | varchar(100) | 任意 | 場所マスタ参照 |
| 10 | location_attr_02 | 場所 | 保管場所 | varchar(100) | 任意 | 場所マスタ参照 |
| 11 | date_attr_01 | 日付 | 購入日 | date | 任意 | YYYY-MM-DD |
| 12 | date_attr_02 | 日付 | 利用開始日 | date | 任意 | YYYY-MM-DD |
| 13 | date_attr_03 | 日付 | 期限日 | date | 任意 | 購入日以降 |
| 14 | free_text_attr_01 | 自由テキスト | 製品型番 | varchar(200) | 任意 | 200文字以内 |
| 15 | free_text_attr_02 | 自由テキスト | 識別ラベル | varchar(200) | 任意 | 200文字以内 |
| 16 | free_text_attr_03 | 自由テキスト | 補足説明 | varchar(500) | 任意 | 500文字以内 |
| 17 | multi_attr_01 | 1:n情報 | 付帯情報 | 別表 | 任意 | 複数登録可 |
| 18 | multi_attr_02 | 1:n情報 | 関連識別子 | 別表 | 任意 | 同一資産内重複不可 |
| 19 | memo_attr_01 | メモ | 運用メモ | text | 任意 | 2000文字以内 |
| 20 | memo_attr_02 | メモ | 監査メモ | text | 任意 | 2000文字以内 |

### 6.4 予算管理対象データ（追加要件）
- 予算分類は `大分類/中分類/小分類` の3階層を必須管理とする
- 予算属性情報は20属性をカテゴリ内訳（個別分類5/人3/場所2/日付3/自由テキスト3/1:n情報2/メモ2）付きで明示する
- 1:n情報（2項目）は別テーブルで保持し、予算に対して複数行登録を許容する

## 7. 非機能要件
- 認証基盤は Django 標準認証を利用する
- セッション有効期限は既定8時間、無操作30分でタイムアウトとする
- ログイン失敗が連続5回に達したユーザは15分ロックする
- CSRF対策を必須とし、状態変更リクエストはCSRFトークン検証を行う
- 権限制御（閲覧/編集）
- 監査ログ保持
- 履歴保持
- CSV出力
- 大量資産対応
- 将来のSAML/OIDC対応

## 8. データ整合性要件
- 予算未紐付け資産の登録を許容する
- 廃棄済資産は構成へ追加不可
- ライセンス上限超過不可
- 保守期限切れ警告を行う
- 資産ごとに属性単一値レコードは1件とする

## 9. 移行要件
- 既存Excel台帳取り込み
- データクレンジング
- 移行後検証（予算不明資産の識別・是正対象化）

## 10. KPI
- 予算消化率
- 未紐付け資産件数
- 保守更新漏れ件数
- 棚卸差異件数
- 構成情報完全率

## 11. トレーサビリティ（参照）
- 画面遷移: `docs/04_画面遷移図.md`
- ER案: `docs/05_ER図案.md`
- 画面項目定義: `docs/06_詳細設計_画面項目定義.md`
- API詳細: `docs/07_詳細設計_API設計.md`
- 論理DDL草案: `docs/08_詳細設計_論理DDL.sql`
- バッチ詳細: `docs/09_詳細設計_バッチ設計.md`
- CSVレイアウト詳細: `docs/10_詳細設計_CSVレイアウト.md`
- 運用手順: `docs/11_運用手順書_Runbook.md`
- UAT観点: `docs/12_UATチェックリスト.md`
- 文書整合MECEチェック: `docs/13_文書整合MECEチェック記録.md`
- 移行項目マッピング: `docs/14_移行項目マッピング表.md`
- 帳票レイアウト定義: `docs/15_帳票レイアウト定義.md`
- 受入基準詳細: `docs/16_受入基準詳細_UAT観点定義.md`
- UAT実施記録: `docs/17_UAT実施記録.md`

## 11.1 機能・画面トレーサビリティ
| 機能ID | 機能 | 画面ID | 画面 |
|---|---|---|---|
| F-00 | 認証/ユーザ管理 | SCR-000 | ログイン |
| F-01 | ダッシュボード可視化 | SCR-001 | ダッシュボード |
| F-02 | 資産管理 | SCR-010, SCR-011 | 資産一覧, 資産詳細/編集 |
| F-03 | 構成管理 | SCR-020 | 構成ビュー |
| F-04 | 予算/執行済予算管理 | SCR-030 | 予算/執行済予算 |
| F-05 | ライセンス管理 | SCR-040 | ライセンスプール |
| F-06 | PC管理 | SCR-050 | PC管理 |
| F-07 | 棚卸管理 | SCR-060 | 棚卸 |
| F-08 | 廃棄承認 | SCR-070 | 廃棄承認 |
| F-09 | 監査ログ閲覧 | SCR-080 | 監査ログ閲覧 |

## 12. 実装マイルストン
| マイルストン | スコープ | 完了条件 | ステータス |
|---|---|---|---|
| M1: 基盤構築 | Djangoプロジェクト作成、認証、共通設定、主要モデル初版 | `apps/account_requests` の3層骨格が成立し、初期テスト通過 | 完了 |
| M2: コア業務API | 資産/廃棄/棚卸/監査API、Service経由更新 | 主要業務更新がView直更新なしで実行可能 | 完了 |
| M3: 残機能API拡張 | 構成/予算/執行済予算/ライセンスAPI、追加マイグレーション | 新規エンドポイント提供と業務制約バリデーションを実装 | 完了 |
| M4: Web画面実装 | ログイン、ダッシュボード、資産/廃棄/監査の主要画面、プレースホルダ接続 | 主要導線でログイン後操作できる | 完了 |
| M5: 画面機能拡張 | 構成/予算/ライセンス/PC/棚卸のプレースホルダを実データ画面化 | 対象画面で一覧・登録・更新の最小操作が可能 | 完了 |
| M6: 運用連携・受入 | CSV入出力、バッチ、受入観点/UAT観点の最終化 | 運用手順・受入基準が文書化され、受入テストで合格 | 完了 |

### 12.1 直近の実装順序（推奨）
1. M5-1: 構成/予算/ライセンス画面の実データ表示化
2. M5-2: PC管理/棚卸画面の更新処理実装
3. M6-1: CSVインポート/エクスポート実装
4. M6-2: バッチ処理（通知・KPI・棚卸対象生成）実装
5. M6-3: UAT観点・運用手順の確定
