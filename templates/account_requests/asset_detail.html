{% extends "account_requests/base.html" %}
{% block title %}資産詳細{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">資産詳細</h1>
    <a href="/assets" class="btn btn-outline-secondary btn-sm">一覧へ戻る</a>
</div>

{% if update_error_message %}<div class="alert alert-danger py-2">{{ update_error_message }}</div>{% endif %}

<div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-white"><strong>基本情報</strong></div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-3"><div class="text-muted small">ID</div><div>{{ asset.id }}</div></div>
            <div class="col-md-3"><div class="text-muted small">資産コード</div><div>{{ asset.asset_code }}</div></div>
            <div class="col-md-3"><div class="text-muted small">資産名</div><div>{{ asset.asset_name }}</div></div>
            <div class="col-md-3"><div class="text-muted small">種別</div><div>{{ asset.asset_kind }}</div></div>
            <div class="col-md-6"><div class="text-muted small">分類</div><div>{{ asset.category_s.category_m.category_l.name }} / {{ asset.category_s.category_m.name }} / {{ asset.category_s.name }}</div></div>
            <div class="col-md-3"><div class="text-muted small">状態</div><div><span class="badge text-bg-secondary">{{ asset.status }}</span></div></div>
            <div class="col-md-3"><div class="text-muted small">予算紐付け</div><div>{{ asset.budget_link_status }}</div></div>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-white"><strong>属性20</strong></div>
    <div class="table-responsive">
        <table class="table table-striped mb-0">
            <tbody>
                <tr><th class="w-25">AS-A-001</th><td>{% if attr_value and attr_value.cls_attr_01 %}{{ attr_value.cls_attr_01 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-002</th><td>{% if attr_value and attr_value.cls_attr_02 %}{{ attr_value.cls_attr_02 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-003</th><td>{% if attr_value and attr_value.cls_attr_03 %}{{ attr_value.cls_attr_03 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-004</th><td>{% if attr_value and attr_value.cls_attr_04 %}{{ attr_value.cls_attr_04 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-005</th><td>{% if attr_value and attr_value.cls_attr_05 %}{{ attr_value.cls_attr_05 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-006 利用者</th><td>{% if attr_value and attr_value.person_attr_01 %}{{ attr_value.person_attr_01.username }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-007 管理責任者</th><td>{% if attr_value and attr_value.person_attr_02 %}{{ attr_value.person_attr_02.username }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-008 最終更新者</th><td>{% if attr_value and attr_value.person_attr_03 %}{{ attr_value.person_attr_03.username }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-009</th><td>{% if attr_value and attr_value.location_attr_01 %}{{ attr_value.location_attr_01 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-010</th><td>{% if attr_value and attr_value.location_attr_02 %}{{ attr_value.location_attr_02 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-011</th><td>{% if attr_value and attr_value.date_attr_01 %}{{ attr_value.date_attr_01|date:"Y-m-d" }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-012</th><td>{% if attr_value and attr_value.date_attr_02 %}{{ attr_value.date_attr_02|date:"Y-m-d" }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-013</th><td>{% if attr_value and attr_value.date_attr_03 %}{{ attr_value.date_attr_03|date:"Y-m-d" }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-014</th><td>{% if attr_value and attr_value.free_text_attr_01 %}{{ attr_value.free_text_attr_01 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-015</th><td>{% if attr_value and attr_value.free_text_attr_02 %}{{ attr_value.free_text_attr_02 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-016</th><td>{% if attr_value and attr_value.free_text_attr_03 %}{{ attr_value.free_text_attr_03 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-017</th><td>{% if multi_attr_01_values %}{{ multi_attr_01_values|length }}件{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-018</th><td>{% if multi_attr_02_values %}{{ multi_attr_02_values|length }}件{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-019</th><td>{% if attr_value and attr_value.memo_attr_01 %}{{ attr_value.memo_attr_01 }}{% else %}-{% endif %}</td></tr>
                <tr><th>AS-A-020</th><td>{% if attr_value and attr_value.memo_attr_02 %}{{ attr_value.memo_attr_02 }}{% else %}-{% endif %}</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white"><strong>AS-A-017 multi_attr_01</strong></div>
            <ul class="list-group list-group-flush">
                {% for item in multi_attr_01_values %}
                <li class="list-group-item">{{ item.value }}</li>
                {% empty %}
                <li class="list-group-item text-muted">-</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white"><strong>AS-A-018 multi_attr_02</strong></div>
            <ul class="list-group list-group-flush">
                {% for item in multi_attr_02_values %}
                <li class="list-group-item">{{ item.value }}</li>
                {% empty %}
                <li class="list-group-item text-muted">-</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0">
    <div class="card-header bg-white"><strong>資産編集</strong></div>
    <div class="card-body">
        <form method="post" class="row g-3">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_asset">

            <div class="col-md-4">
                <label class="form-label">資産名</label>
                <input type="text" class="form-control" name="asset_name" value="{{ edit_form.asset_name|default:'' }}" required>
            </div>
            <div class="col-md-4">
                <label class="form-label">小分類</label>
                <select class="form-select" name="category_s_id" required>
                    {% for category_s in category_s_options %}
                    <option value="{{ category_s.id }}" {% if edit_form.category_s_id == category_s.id|stringformat:"s" %}selected{% endif %}>
                        {{ category_s.category_m.category_l.name }} / {{ category_s.category_m.name }} / {{ category_s.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">資産区分</label>
                <select class="form-select" name="asset_kind" required>
                    {% for value, label in asset_kind_options %}
                    <option value="{{ value }}" {% if edit_form.asset_kind == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">状態</label>
                <select class="form-select" name="status">
                    {% for value, label in status_options %}
                    <option value="{{ value }}" {% if edit_form.status == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-12"><hr class="my-1"></div>
            <div class="col-12"><strong class="small text-muted">属性20編集</strong></div>

            <div class="col-md-4"><label class="form-label">AS-A-001</label><input type="text" class="form-control" name="cls_attr_01" value="{{ edit_form.cls_attr_01|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-002</label><input type="text" class="form-control" name="cls_attr_02" value="{{ edit_form.cls_attr_02|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-003</label><input type="text" class="form-control" name="cls_attr_03" value="{{ edit_form.cls_attr_03|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-004</label><input type="text" class="form-control" name="cls_attr_04" value="{{ edit_form.cls_attr_04|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-005</label><input type="text" class="form-control" name="cls_attr_05" value="{{ edit_form.cls_attr_05|default:'' }}"></div>
            <div class="col-md-4">
                <label class="form-label">AS-A-006 利用者</label>
                <select class="form-select" name="person_attr_01">
                    <option value="">--</option>
                    {% for person in person_options %}
                    <option value="{{ person.id }}" {% if edit_form.person_attr_01 == person.id|stringformat:"s" %}selected{% endif %}>{{ person.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">AS-A-007 管理責任者</label>
                <select class="form-select" name="person_attr_02" required>
                    <option value="">--</option>
                    {% for person in person_options %}
                    <option value="{{ person.id }}" {% if edit_form.person_attr_02 == person.id|stringformat:"s" %}selected{% endif %}>{{ person.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">AS-A-008 最終更新者</label>
                <select class="form-select" name="person_attr_03">
                    <option value="">--</option>
                    {% for person in person_options %}
                    <option value="{{ person.id }}" {% if edit_form.person_attr_03 == person.id|stringformat:"s" %}selected{% endif %}>{{ person.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4"><label class="form-label">AS-A-009</label><input type="text" class="form-control" name="location_attr_01" value="{{ edit_form.location_attr_01|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-010</label><input type="text" class="form-control" name="location_attr_02" value="{{ edit_form.location_attr_02|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-011</label><input type="date" class="form-control" name="date_attr_01" value="{{ edit_form.date_attr_01|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-012</label><input type="date" class="form-control" name="date_attr_02" value="{{ edit_form.date_attr_02|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-013</label><input type="date" class="form-control" name="date_attr_03" value="{{ edit_form.date_attr_03|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-014</label><input type="text" class="form-control" name="free_text_attr_01" value="{{ edit_form.free_text_attr_01|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-015</label><input type="text" class="form-control" name="free_text_attr_02" value="{{ edit_form.free_text_attr_02|default:'' }}"></div>
            <div class="col-md-4"><label class="form-label">AS-A-016</label><input type="text" class="form-control" name="free_text_attr_03" value="{{ edit_form.free_text_attr_03|default:'' }}"></div>
            <div class="col-md-6"><label class="form-label">AS-A-019</label><textarea class="form-control" name="memo_attr_01" rows="2">{{ edit_form.memo_attr_01|default:'' }}</textarea></div>
            <div class="col-md-6"><label class="form-label">AS-A-020</label><textarea class="form-control" name="memo_attr_02" rows="2">{{ edit_form.memo_attr_02|default:'' }}</textarea></div>

            <div class="col-12"><strong class="small text-muted">1:n属性編集</strong></div>
            <div class="col-md-6"><label class="form-label">AS-A-017 multi_attr_01（1行1件）</label><textarea class="form-control" name="multi_attr_01_lines" rows="3">{{ edit_form.multi_attr_01_lines|default:'' }}</textarea></div>
            <div class="col-md-6"><label class="form-label">AS-A-018 multi_attr_02（1行1件）</label><textarea class="form-control" name="multi_attr_02_lines" rows="3">{{ edit_form.multi_attr_02_lines|default:'' }}</textarea></div>

            <div class="col-12 text-end">
                <button type="submit" class="btn btn-primary">更新</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}